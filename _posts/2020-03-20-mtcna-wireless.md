---
layout: post
title: MTCNA - Wireless
category: notes
date: 2020-03-20T10:00:00
tags: mikrotik mtcna router-board wireless
comments: false
---
درباره کانفیگ و قابلیت‌های wireless میکروتیک
<!--break-->

## استانداردها

| 5GHz (20MHz) 54Mbps | 802.11a |
|--------------------------------------------------------|---------|
| 2.4GHz (22MHz) 11Mbps | 802.11b |
| 2.4GHz (22MHz) 54Mbps | 802.11g |
| 2.4GHz/5GHz (22MHz) 300Mbps (using 40MHz and 2 radios) | 802.11n |

منظور از 2.4GHz یا 5GHz در واقع یک بازه فرکانسی ست و یک فرکانس خاص نیست. مثلا 2.4GHz بازه حدودی 2.4GHz تا 2.5GHz رو شامل میشه که ممکنه تو کشورهای مختلف این بازه کمی متغیر باشه.

در استاندارد 802.11b,g ۱۴ این بازه به ۱۴ کانال تقسیم میشه و هرکانال ها هم یک فرکانس مرجع دارن که center frequency نامیده میشه که برابر با عدد وسط هر کانال

{% include image.html 
    url="/assets/posts/mtcna/802-channels.png"
    width="600px%" %}

همونطور که میبینیم کانالها باهم همپوشانی دارن و میتونن تداخل ایجاد کنن. و ما حداکثر ۳ تا کانال میتونیم توی این بازه پیدا کنیم که هیچ تداخلی باهم نداشته باشن و ما نهایتا ۳ تا اکسس پوینت میتونیم داشته باشیم که باهم تداخل سیگنال ایجاد نکنن و کاملا ایزوله باشن

توی استاندارد 802.11a که ۱۲ کانال با پهنای 20MHz داریم. البته ۵ کانال 40MHz هم داریم که به نام turbo channel که چون بازه بزرگتری دارن سرعت انتقال بالاتری هم دارن. اما مشکلش اینه تداخل سیگنال رو بیشتر میکنه. توی این حالت اگر میخواستیم بریم روی turbo همه دیوایسا باید عرض 40 رو پشتیبانی میکردن وگرنه نمیتونستن استفاده کنن.

توی 802.11n هم کانالای عرض 20MHz داریم هم 40MHz که تعریفاشون مثل استانداردای قبلیه. اما توی 5GHz ش بصورت توربو نیستن و Channel Bounding عه. ینی یکی از کانالای 20MHz رو به عنوان center channel انتخاب میکنه و یه کانال بالا یا پایین ترشو به عنوان Extension Channel  و اینکار رو هم بخاطر compatibility انجام میده  با دستگاهاییه که کانال عرض 20GHz رو پشتیبانی میکنه


## Bands 
میکروتیک باندهای فرکانسی 5GHz یعنی استاندارد های 802.11a/n و 2.4GHz یعنی استانداردهای 802.11b/g/m رو به همراه Small (Narrow) Channels پشتیبانی میکنه که برعکس turbo channel عه که یعنی میاد عرض 5 یا 10MHz استفاده میکنه. البته توی استاندارد n و ac دیگه Small Channel رو نداریم.

## قوانین کشوری
پارامتر Country محدودیت فرکانس و حداکثر توان رو تعیین میکنه 
- گزینه no_country_set طبق قانون FCC ست میکنه

توی Wireless و تو حالت Advance mode گزینه Country هست

Frequency mode
- Regulatory-domain محدودیت فرکانس و حداکثر توان خروجی بر اساس قوانین کشور
- Manual-txpower فقط محدودیت فرکانس فعاله
- Supperchannel هیچ محدودیتی نداره

توی شبکه های بی‌سیم یکی از دستگاها میشه Access Point و باقی میشن Station که در واقع اکسس پوینت میشه مدیر و باقی میشن استفاده کننده. Access Point در واقع همیشه داره خودشو معرفی میکنه که Station ها بتونن ببینش و ازش سرویس بگیرن

## Station

توی بخش Wireless وقتی تب Interfaces رو انتخاب کنیم و یکی از وایرلس هارو انتخاب کنیم، توی جزییات یه گزینه mode داره که همین نقش رو  مشخص میکنه. در حالت استیشن فرکانس رو تعیین نمیکنیم.

## Scan list
زمانی که یک Station میخواد یک AP رو پیدا کنه و بهش متصل شه، تو یه سری از فرکانسا میگرده و AP مناسب خودشو  پیدا میکنه که توی Scan list میشه تنظیمشون کرد.

- گزینه دیفالت در واقع شامل فرکانس ها بولد توی لیست فرکانس ها درواقع فرکانسای استاندارد های 802.11 اون کشوره
- میشه بهش بازه داد
- میشه یه فرکانس خاص رو مشخص کرد

که توی لیست scan ها میتونیم همه چیو ببینیم. هرچی تعداد فرکانسهای scan list بیشتر باشه مدت زمان بیشتری طول میکشه تا اسکن کنه


تب Registration توی Wireless شامل دستگاه های متصل شده به وایرلسمونه

تب Connect List در واقع شامل قوانینی هست که برای استیشن میذاریم تا بتونه به AP ها وصل بشه. مثل اینکه به AP هایی با چه قدرت سیگنال و پروتکل یا SSID یا area خاص و… . یه آپشن connect هم داره که مشخص کنیم به AP با این مشخصات کانکت بشه یا نشه. 


موقعی که استیشن داره اسکن میکنه کارت شبکه‌ش از کار میفته و برای این موضوع میتونیم پکیج wireless repeater رو نصب کنیم و تو صفحه اسکن تیک background scan رو بزنیم

## Access Point
برای اینکه وایرلس ما به Access Point تبدیل کنیم کافیه mode رو روی ap bridge 

وقتی به ap bridge وصل میشیم چون برودکست همه AP ها یکیه، اگر جابجا بشیم و تو محل AP های دیگه‌ای وجود داشته باشه درصورتی که AP مون هم تغییر کنه دیگه IP مون تغییری نمیکنه که بهش میگن roming 

## انواع مودها
- station بالاتر گفتیم
- ap-bridge در واقع همون access point ییه که دربارش گفتیم
- bridge توی این مود فقط یه استیشن حق داره بهش وصل شه. یعنی وقتی که میخوایم یه لینک p2p ایجاد کنیم
- station-bridge هم یک مود خاص میکروتیکه که یه بریج لایه دویی امن بین روترهای میکروتیک ایجاد میکنه و برای بسط دادن سابنت ها استفاده میشه
- station pseudobridge برای اکسس پوینتای غیر RouterOS
- station pseudobridge clone برای اکسس پوینتای غیر RouterOS

## Security Profile
در واقع پروفایلی برای اتصال به یه AP هست و توی تب Security Profiles توی Wireless هست. با تغییر security profile یه اینترفیس همه استیشن ها قطع میشن

## Frequency Selection
همونطور که میدونیم فرکانس رو AP تعیین میکنه. برای اینکه ببینیم از چه فرکانسایی استفاده میشه از Snooper استفاده میکنیم. توی تب Wireless و بعد از انتخاب اینترفیس خودمون دکمه Snooper رو ببینیم و توی صفحه مربوطه کانال های درحال استفاده رو میتونیم ببینیم

## Access List
همونطور که توی Station ما Connect List داشتیم توی AP هم Access List داریم که برای محدود کردن اتصالات و کنترل پارامترهای ارتباطی. در واقع برای اینکه بگیم کیا میتونن به API مون میتونه متصل شه یه سری Rule قرار تعریف میکنیم. این Rule ها اولویت بندی دارن و با اولی که مچ بشه ارتباط اولیه برقرار میشه.

حالا آیا اتصال برقرار میشه؟ خیر. بعدش Security Profile رو چک میکنه

توی Wireless تب Access List میتونیم Rule هارو ایجاد کنیم که پارامترهایی مثل MAC، قدرت سیگنال و… داره. اینجا بعضی محدودیت های لایه دویی هم وجود داره. 

مثلا پهنای باند رو محدود کنم از طریق AP Tx Limit که همون سرعت دانلود میشه و Client Tx Limit هم سرعت آپلودش. نکته اینجاست که AP Tx Limit روی AP اعمال میشه و شامل همه استیشنا میشه اما Client Tx Limit فقط برای اونایی که RouterOS دارن اعمال میشه و باقی استیشنا اینو نمیفهمن.

حتی میشه Pre Shared Key ست کرد. به اینصورت که اون استیشن خاص باید ازین پسورد استفاده کنه. البته security profile یه pre shared key عمومیه و این بصورت خاص برای اون MAC خاص اعمال میشه.

حالا اگر هیچکدوم rule های Access List در حالت AP و با هیچکدوم از rule های Connect List توی Station مچ نشد چه اتفاقی براش میفته؟

توی جزییات یک اینترفیس وایرلس توی تب wireless یک سری دیفالت هارو میتونیم مشخص کنیم. مثل
- Default Authentication
- Default forward
- Default AP Tx Limit
- Default Client Tx Limit

و ازین طریق پیش‌فرض ها رو مقداردهی میکنیم.

حالا اگر Default Authentication رو برداریم فقط میاد rule هارو چک میکنه و یوزرایی که مطابقت نداشته باشن رو قطع میکنه.

به طور کلی اول میان Access List و Connect List چک میشن و اگر با هیچکدوم مچ نباشن حالا به این پیشفرضا مراجعه میکنن. که ما میتونیم این پیشفرض هارو غیرفعال کنیم.

## Virtual AP
یه AP جدید روی کارت وایرلس فیزیکی ساخته میشه که مک متفاوت هم داره و متغیرم هست. در واقع همه موارد SSID, Security Profile, Connection/Access List, WDS متفاوت با کارت وایرلس فیزیکیمون داشته باشه

مثال کاربردیش اینه برای مدت محدودی میخوایم یکسری رو بیاریم توی شبکمون.

توی Wireless و تب Interfaces میتونیم یه Virtual AP اضافه کنیم.